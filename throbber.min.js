/*
 throbber.js v 0.1 2011-09-18
 http://aino.com

 Copyright (c) 2011, Aino
 Licensed under the MIT license.

*/
(function(n){var g=n.document,k=g.body,e=Math,h="getContext"in g.createElement("canvas"),i=function(d,a){var d=d||{},b;for(b in a)d[b]=a[b];return d},l=function(d,a,b){b=b?-2:2;d.translate(a/b,a/b)},o,j,p,q=1;Throbber=function(d){var a=this.elem=g.createElement("canvas"),b=this;isNaN(d)||(d={size:d});this.o={size:50,rotationspeed:6,clockwise:!0,color:"#fff",fade:400,fallback:!1,alpha:1};this.configure(d);this.phase=-1;if(h)this.ctx=a.getContext("2d"),a.width=a.height=this.o.size;else if(this.o.fallback)a=
this.elem=new Image,a.src=this.o.fallback;this.loop=function(){var c=b.o,d=0,g=1E3/c.fade/c.fps,m=b.step,i=a.style,k="filter"in i&&c.fallback&&!h;return function(){if(b.phase==3&&(d-=g,d<=0))b.phase=0;if(b.phase==1&&(d+=g,d>=1))b.phase=2;if(k)i.filter="alpha(opacity="+e.min(100,e.max(0,Math.round(d*100)))+")";else{var a=b.ctx,h=m;o=1-d||0;var f=c.size;c.clockwise||(q=-1);a.clearRect(0,0,f,f);a.globalAlpha=c.alpha;a.lineWidth=c.strokewidth;for(j=0;j<c.lines;j++)p=j+h>=c.lines?j-c.lines+h:j+h,a.strokeStyle=
"rgba("+c.color.join(",")+","+e.max(0,p/c.lines-o)+")",a.beginPath(),a.moveTo(f/2,f/2-c.padding/2),a.lineTo(f/2,0),a.stroke(c.strokewidth),l(a,f,!1),a.rotate(q*(360/c.lines)*e.PI/180),l(a,f,!0);a.save();l(a,f,!1);a.rotate(-1*(360/c.lines/(20-c.rotationspeed*2))*e.PI/180);l(a,f,!0);m=m===0?b.o.lines:m-1}n.setTimeout(b.loop,1E3/c.fps)}}()};Throbber.prototype={constructor:Throbber,appendTo:function(d){this.elem.style.display="none";d.appendChild(this.elem);return this},configure:function(d){var a,b,
c=this.o;i(c,d||{});a=c.color;h?(b=g.createElement("i"),b.style.display="none",b.style.color=a,k.appendChild(b),a=n.getComputedStyle(b,null).getPropertyValue("color").replace(/^rgba?\(([^\)]+)\)/,"$1").replace(/\s/g,"").split(",").splice(0,4),k.removeChild(b),b=a.length==4?a.pop():1):(a=!1,b=1);i(c,i({padding:c.size/2,strokewidth:e.max(1,e.min(c.size/30,3)),lines:e.min(30,c.size/2+4),alpha:b||1,fps:e.min(30,c.size+4)},d));c.color=a;this.step=c.lines;return this},start:function(){this.elem.style.display=
"block";this.phase==-1&&this.loop();this.phase=1;return this},stop:function(){this.phase=3;return this}}})(this);